(()=>{var t={912:function(t){t.exports=function(){"use strict";var t=6e4,e=36e5,r="millisecond",n="second",a="minute",s="hour",o="day",i="week",u="month",c="quarter",d="year",l="date",f="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},v=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},y={s:v,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),a=r%60;return(e<=0?"+":"-")+v(n,2,"0")+":"+v(a,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),a=e.clone().add(n,u),s=r-a<0,o=e.clone().add(n+(s?-1:1),u);return+(-(n+(r-a)/(s?a-o:o-a))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:u,y:d,w:i,d:o,D:l,h:s,m:a,s:n,ms:r,Q:c}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},b="en",g={};g[b]=p;var D="$isDayjsObject",_=function(t){return t instanceof M||!(!t||!t[D])},w=function t(e,r,n){var a;if(!e)return b;if("string"==typeof e){var s=e.toLowerCase();g[s]&&(a=s),r&&(g[s]=r,a=s);var o=e.split("-");if(!a&&o.length>1)return t(o[0])}else{var i=e.name;g[i]=e,a=i}return!n&&a&&(b=a),a||!n&&b},$=function(t,e){if(_(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new M(r)},S=y;S.l=w,S.i=_,S.w=function(t,e){return $(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var M=function(){function p(t){this.$L=w(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[D]=!0}var v=p.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(S.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(h);if(n){var a=n[2]-1||0,s=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],a,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)):new Date(n[1],a,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)}}return new Date(e)}(t),this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return S},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(t,e){var r=$(t);return this.startOf(e)<=r&&r<=this.endOf(e)},v.isAfter=function(t,e){return $(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<$(t)},v.$g=function(t,e,r){return S.u(t)?this[e]:this.set(r,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var r=this,c=!!S.u(e)||e,f=S.p(t),h=function(t,e){var n=S.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return c?n:n.endOf(o)},m=function(t,e){return S.w(r.toDate()[t].apply(r.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},p=this.$W,v=this.$M,y=this.$D,b="set"+(this.$u?"UTC":"");switch(f){case d:return c?h(1,0):h(31,11);case u:return c?h(1,v):h(0,v+1);case i:var g=this.$locale().weekStart||0,D=(p<g?p+7:p)-g;return h(c?y-D:y+(6-D),v);case o:case l:return m(b+"Hours",0);case s:return m(b+"Minutes",1);case a:return m(b+"Seconds",2);case n:return m(b+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var i,c=S.p(t),f="set"+(this.$u?"UTC":""),h=(i={},i[o]=f+"Date",i[l]=f+"Date",i[u]=f+"Month",i[d]=f+"FullYear",i[s]=f+"Hours",i[a]=f+"Minutes",i[n]=f+"Seconds",i[r]=f+"Milliseconds",i)[c],m=c===o?this.$D+(e-this.$W):e;if(c===u||c===d){var p=this.clone().set(l,1);p.$d[h](m),p.init(),this.$d=p.set(l,Math.min(this.$D,p.daysInMonth())).$d}else h&&this.$d[h](m);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[S.p(t)]()},v.add=function(r,c){var l,f=this;r=Number(r);var h=S.p(c),m=function(t){var e=$(f);return S.w(e.date(e.date()+Math.round(t*r)),f)};if(h===u)return this.set(u,this.$M+r);if(h===d)return this.set(d,this.$y+r);if(h===o)return m(1);if(h===i)return m(7);var p=(l={},l[a]=t,l[s]=e,l[n]=1e3,l)[h]||1,v=this.$d.getTime()+r*p;return S.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||f;var n=t||"YYYY-MM-DDTHH:mm:ssZ",a=S.z(this),s=this.$H,o=this.$m,i=this.$M,u=r.weekdays,c=r.months,d=r.meridiem,l=function(t,r,a,s){return t&&(t[r]||t(e,n))||a[r].slice(0,s)},h=function(t){return S.s(s%12||12,t,"0")},p=d||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(m,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return S.s(e.$y,4,"0");case"M":return i+1;case"MM":return S.s(i+1,2,"0");case"MMM":return l(r.monthsShort,i,c,3);case"MMMM":return l(c,i);case"D":return e.$D;case"DD":return S.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return l(r.weekdaysMin,e.$W,u,2);case"ddd":return l(r.weekdaysShort,e.$W,u,3);case"dddd":return u[e.$W];case"H":return String(s);case"HH":return S.s(s,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return p(s,o,!0);case"A":return p(s,o,!1);case"m":return String(o);case"mm":return S.s(o,2,"0");case"s":return String(e.$s);case"ss":return S.s(e.$s,2,"0");case"SSS":return S.s(e.$ms,3,"0");case"Z":return a}return null}(t)||a.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,l,f){var h,m=this,p=S.p(l),v=$(r),y=(v.utcOffset()-this.utcOffset())*t,b=this-v,g=function(){return S.m(m,v)};switch(p){case d:h=g()/12;break;case u:h=g();break;case c:h=g()/3;break;case i:h=(b-y)/6048e5;break;case o:h=(b-y)/864e5;break;case s:h=b/e;break;case a:h=b/t;break;case n:h=b/1e3;break;default:h=b}return f?h:S.a(h)},v.daysInMonth=function(){return this.endOf(u).$D},v.$locale=function(){return g[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=w(t,e,!0);return n&&(r.$L=n),r},v.clone=function(){return S.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},p}(),N=M.prototype;return $.prototype=N,[["$ms",r],["$s",n],["$m",a],["$H",s],["$W",o],["$M",u],["$y",d],["$D",l]].forEach((function(t){N[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),$.extend=function(t,e){return t.$i||(t(e,M,$),t.$i=!0),$},$.locale=w,$.isDayjs=_,$.unix=function(t){return $(1e3*t)},$.en=g[b],$.Ls=g,$.p={},$}()},735:t=>{"use strict";t.exports=flarum.extensions["fof-byobu"]}},e={};function r(n){var a=e[n];if(void 0!==a)return a.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{components:()=>pt,models:()=>vt,states:()=>yt,utils:()=>bt});const t=flarum.core.compat["common/extend"],e=flarum.core.compat["common/models/User"];var a=r.n(e);const s=flarum.core.compat["common/Model"];var o=r.n(s);const i=flarum.core.compat["common/utils/Stream"];var u=r.n(i);function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}const l=flarum.core.compat["forum/app"];var f=r.n(l);const h=flarum.core.compat["common/utils/ItemList"];var p=r.n(h);const v=flarum.core.compat["common/utils/mixin"],y=function(t,e){return Array.isArray(t)?t.map(e).sort():e(t)};var b=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(r.n(v)()(o(),{user:o().hasOne("user"),content:o().attribute("content"),title:o().attribute("title"),scheduledValidationError:o().attribute("scheduledValidationError"),relationships:o().attribute("relationships"),extra:o().attribute("extra"),scheduledFor:o().attribute("scheduledFor",o().transformDate),updatedAt:o().attribute("updatedAt",o().transformDate),loadedRelationships:null,type:function(){var t=this.loadRelationships();return t.discussion?"reply":flarum.extensions["fof-byobu"]&&flarum.extensions["fof-byobu"].discussions&&("recipientGroups"in t||"recipientUsers"in t)?"privateDiscussion":"discussion"},icon:function(){switch(this.type()){case"discussion":return"fas fa-edit";case"reply":return"fas fa-reply";case"privateDiscussion":return f().forum.data.attributes["byobu.icon-badge"]||"fas fa-eye-slash"}},loadRelationships:function(t){var e=this;if(!t&&this.loadedRelationships&&(Object.keys(this.loadedRelationships).length>0||0===Object.keys(this.loadedRelationships).length&&0===Object.keys(this.relationships).length))return this.loadedRelationships;this.loadedRelationships={};var r=this.relationships();if(r&&Object.keys(r).forEach((function(t){var n=r[t];n&&n.data&&(e.loadedRelationships[t]=y(n.data,(function(t){return f().store.getById(t.type,t.id)})))})),"recipientUsers"in this.loadedRelationships||"recipientGroups"in this.loadedRelationships){var n=new(p());(this.loadedRelationships.recipientUsers||[]).forEach((function(t){t&&n.add("users:"+t.id(),t)})),(this.loadedRelationships.recipientGroups||[]).forEach((function(t){t&&n.add("groups:"+t.id(),t)})),this.loadedRelationships.recipients=n}return this.loadedRelationships},compileData:function(){var t={originalContent:this.content(),title:this.title(),user:f().session.user,confirmExit:f().translator.trans("fof-drafts.forum.composer.exit_alert"),draft:this,fields:Object.assign({},this.loadRelationships(),this.extra())};return Object.assign(t,t.fields),t}}));const g=flarum.core.compat["common/components/Page"];var D=r.n(g);const _=flarum.core.compat["common/Component"];var w=r.n(_);const S=flarum.core.compat["common/components/LoadingIndicator"];var M=r.n(S);const N=flarum.core.compat["common/components/Button"];var A=r.n(N);const x=flarum.core.compat["common/helpers/avatar"];var O=r.n(x);const k=flarum.core.compat["common/helpers/icon"];var I=r.n(k);const j=flarum.core.compat["common/helpers/humanTime"];var C=r.n(j);const F=flarum.core.compat["common/utils/string"],E=flarum.core.compat["common/components/Tooltip"];var L=r.n(E),T=r(912),B=r.n(T),R=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).canSchedule=f().forum.attribute("canScheduleDrafts")&&f().forum.attribute("drafts.enableScheduledDrafts"),e}d(e,t);var r=e.prototype;return r.oncreate=function(e){t.prototype.oncreate.call(this,e)},r.view=function(){var t=this.attrs,e=t.draft,r=t.state,n="far fa-calendar-plus";return e.scheduledValidationError()?n="far fa-calendar-times":e.scheduledFor()&&(n="far fa-calendar-check"),m("li",null,m("a",{onclick:r.showComposer.bind(r,e),className:"Notification draft--item"},O()(e.user()),I()(e.icon(),{className:"Notification-icon"}),m("span",{class:"Notification-title"},m("span",{className:"Notification-content"},e.scheduledFor()&&m(L(),{showOnFocus:!1,text:f().translator.trans("fof-drafts.forum.dropdown.scheduled_icon_tooltip",{datetime:B()(e.scheduledFor()).format(f().translator.trans("fof-drafts.forum.dropdown.scheduled_icon_tooltip_formatter")[0])})},I()("far fa-clock",{className:"draft--scheduledIcon"})),"reply"===e.type()?e.loadRelationships().discussion.title():e.title()),m("span",{class:"Notification-title-spring"}),C()(e.updatedAt())),m("div",{class:"Notification-action"},m(L(),{showOnFocus:!1,text:f().translator.trans("fof-drafts.forum.dropdown.delete_button")},m(A(),{"data-container":"body",icon:"fas fa-trash-alt",className:"Notification-action Button Button--link hasIcon draft--delete",onclick:function(t){r.deleteDraft(e),t.stopPropagation()}})),this.canSchedule?m(L(),{showOnFocus:!1,text:f().translator.trans("fof-drafts.forum.dropdown.schedule_button")},m(A(),{"data-container":"body",icon:n,className:"Notification-action Button Button--link hasIcon draft--schedule",onclick:function(t){r.scheduleDraft(e),t.stopPropagation()}})):null),m("div",{className:"Notification-excerpt"},(0,F.truncate)(e.content(),200)),e.scheduledValidationError()?m("p",{className:"scheduledValidationError"},e.scheduledValidationError()):""))},e}(w()),Y=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.oncreate=function(e){t.prototype.oncreate.call(this,e),$(".draft--delete").on("click tap",(function(t){t.stopPropagation()}))},r.deleteAll=function(){confirm(f().translator.trans("fof-drafts.forum.dropdown.delete_all_alert"))&&f().request({method:"DELETE",url:f().forum.attribute("apiUrl")+"/drafts/all"}).then((function(){f().store.data.drafts=[],m.redraw()}))},r.view=function(){var t=f().store.all("drafts"),e=this.attrs.state;return m("div",{className:"NotificationList DraftsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},f().translator.trans("fof-drafts.forum.dropdown.title")),m("div",{class:"App-primaryControl"},m(L(),{showOnFocus:!1,text:f().translator.trans("fof-drafts.forum.dropdown.delete_all_button")},m(A(),{"data-container":"body",icon:"fas fa-trash-alt",className:"Button Button--link Button--icon Alert-dismiss",onclick:this.deleteAll.bind(this)})))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},t.length?t.sort((function(t,e){return e.updatedAt()-t.updatedAt()})).map((function(t){return m(R,{draft:t,state:e})})):null,e.loading?m(M(),{display:"block"}):!t.length&&m("div",{className:"NotificationList-empty"},f().translator.trans("fof-drafts.forum.dropdown.empty_text")))))},e}(w()),P=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),f().history.push("drafts"),f().drafts.load(),this.bodyClass="App--drafts"},r.view=function(){return m("div",{className:"DraftsPage"},m(Y,{state:f().drafts}))},e}(D());const H=flarum.core.compat["common/components/HeaderSecondary"];var V=r.n(H);const U=flarum.core.compat["common/components/NotificationsDropdown"];var W=function(t){function e(){return t.apply(this,arguments)||this}d(e,t),e.initAttrs=function(e){e.label=e.label||f().translator.trans("fof-drafts.forum.dropdown.tooltip"),e.icon=e.icon||"fas fa-edit",t.initAttrs.call(this,e)};var r=e.prototype;return r.getMenu=function(){return m("div",{className:"Dropdown-menu "+this.attrs.menuClassName,onclick:this.menuClick.bind(this)},this.showing?Y.component({state:this.attrs.state}):"")},r.goToRoute=function(){m.route.set(f().route("drafts"))},r.getUnreadCount=function(){return f().cache.draftsLoaded?f().store.all("drafts").length:f().store.all("drafts").length+f().session.user.draftCount()},r.getNewCount=function(){return 0},e}(r.n(U)());const z=flarum.core.compat["common/components/FieldSet"];var G=r.n(z);const J=flarum.core.compat["common/components/SettingsPage"];var Z=r.n(J);const q=flarum.core.compat["common/components/Switch"];var Q=r.n(q);const K=flarum.core.compat["forum/components/Composer"];var X=r.n(K);const tt=flarum.core.compat["forum/components/DiscussionComposer"];var et=r.n(tt);const rt=flarum.core.compat["forum/components/ReplyComposer"];var nt=r.n(rt);const at=flarum.core.compat["forum/states/ComposerState"];var st=r.n(at);const ot=flarum.core.compat["common/components/Alert"];var it=r.n(ot);const ut=flarum.core.compat["common/components/Modal"];var ct=r.n(ut),dt=dayjs().format("YYYY-MM-DD"),lt=dayjs().format("HH:mm"),ft=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).loading=!1,e.date=void 0,e.time=void 0,e.previewFormatString=void 0,e}d(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.date=this.isScheduled()?dayjs(this.attrs.draft.scheduledFor()).format("YYYY-MM-DD"):dt,this.time=this.isScheduled()?dayjs(this.attrs.draft.scheduledFor()).format("HH:mm"):lt,this.previewFormatString=f().translator.trans("fof-drafts.forum.schedule_draft_modal.schedule_time_preview_formatter")[0]},r.className=function(){return"ScheduleDraftModal"},r.title=function(){return f().translator.trans("fof-drafts.forum.schedule_draft_modal.title")},r.content=function(){var t=this;return this.loading?m(M(),null):[this.attrs.draft.scheduledFor()?m("div",{className:"Modal-alert"},m(it(),{type:"success",dismissible:!1},f().translator.trans("fof-drafts.forum.schedule_draft_modal.scheduled_text",{datetime:this.formattedDateTime()}))):"",this.attrs.draft.scheduledValidationError()?m("div",{className:"Modal-alert"},m(it(),{type:"error",dismissible:!1},f().translator.trans("fof-drafts.forum.schedule_draft_modal.scheduled_error",{error:this.attrs.draft.scheduledValidationError()}))):"",m("input",{style:"display: none"}),m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},f().translator.trans("fof-drafts.forum.schedule_draft_modal.text")),m("div",{className:"Form-group ScheduleDraftModal-timeDateGroup"},m("input",{name:"scheduledForDate",className:"FormControl",type:"date",min:dt,value:this.date,onchange:function(e){return t.date=e.target.value}}),m("input",{name:"scheduledForTime",className:"FormControl",type:"time",value:this.time,onchange:function(e){return t.time=e.target.value}})),m("div",{class:"Form-group ScheduleDraftModal-datePreview"},f().translator.trans("fof-drafts.forum.schedule_draft_modal.schedule_time_preview",{datetime:this.formattedDateTime()})),m("div",{className:"Form-group ScheduleDraftModal-submitButtons"},this.isScheduled()&&m(A(),{className:"ScheduleDraftModal-unscheduleBtn Button Button--block Button--danger",loading:this.loading,onclick:this.unschedule.bind(this)},f().translator.trans("fof-drafts.forum.schedule_draft_modal.unschedule_button")),m(A(),{className:"ScheduleDraftModal-scheduleBtn Button Button--block Button--primary",type:"submit",loading:this.loading,disabled:!this.changed()},this.isScheduled()?f().translator.trans("fof-drafts.forum.schedule_draft_modal.reschedule_button"):f().translator.trans("fof-drafts.forum.schedule_draft_modal.schedule_button")))))]},r.scheduledFor=function(){return new Date(this.date+" "+this.time)||null},r.changed=function(){var t=function(t){return t&&t.getTime()||null};return t(this.scheduledFor())!==t(this.attrs.draft.scheduledFor())},r.isScheduled=function(){return!!this.attrs.draft.scheduledFor()},r.formattedDateTime=function(){return dayjs(this.scheduledFor()).format(this.previewFormatString)},r.unschedule=function(t){var e=this;t.preventDefault(),this.loading=!0,confirm(f().translator.trans("fof-drafts.forum.schedule_draft_modal.unschedule_warning"))&&this.attrs.draft.save({scheduledFor:null,clearValidationError:!0,scheduledValidationError:""}).then((function(){e.success=!0,e.hide.call(e)})).catch((function(){})).then(this.loaded.bind(this))},r.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.attrs.draft.save({scheduledFor:this.scheduledFor(),clearValidationError:!0,scheduledValidationError:""}).then((function(){return e.success=!0})).catch((function(){})).then(this.loaded.bind(this))},e}(ct()),ht=function(){function t(){this.loading=!1,this.cache=[]}var e=t.prototype;return e.deleteDraft=function(t){var e=this;window.confirm(f().translator.trans("fof-drafts.forum.dropdown.alert"))&&(this.loading=!0,t.delete().then((function(){f().composer.body&&f().composer.draft&&f().composer.draft.id()===t.id()&&!f().composer.changed()&&f().composer.hide(),e.loading=!1,m.redraw()})))},e.scheduleDraft=function(t){f().forum.attribute("canScheduleDrafts")&&f().forum.attribute("drafts.enableScheduledDrafts")&&f().modal.show(ft,{draft:t})},e.showComposer=function(t){if(!this.loading)return new Promise((function(e){var n;switch(t.type()){case"privateDiscussion":n=r(735).discussions.PrivateDiscussionComposer;break;case"reply":n=nt();break;default:n=et()}var a=t.compileData();return f().composer.load(n,a),f().composer.show(),Object.assign(f().composer.fields,a.fields),e(f().composer)}))},e.load=function(){var t=this;f().cache.draftsLoaded||(this.loading=!0,m.redraw(),f().store.find("drafts").then((function(){return f().cache.draftsLoaded=!0}),(function(){})).then((function(){t.loading=!1,m.redraw()})))},t}();function mt(t,e){if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e||null==t||null==e)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(var a=0,s=r;a<s.length;a++){var o=s[a];if(!n.includes(o)||!mt(t[o],e[o]))return!1}return!0}var pt={DraftsDropdown:W,DraftsList:Y,DraftsListItem:R,DraftsPage:P,ScheduleDraftModal:ft},vt={Draft:b},yt={DraftsListState:ht},bt={fillRelationship:y};function gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}f().initializers.add("fof-drafts",(function(){function e(){var t=this;Object.keys(this.attrs).forEach((function(e){["originalContent","title","user"].includes(e)?"title"===e&&(t.title=u()(t.attrs.title)):t[e]=t.attrs[e]})),this.data&&(this.composer.data=this.data.bind(this)),this.attrs.draft&&(this.composer.draft=this.attrs.draft)}function r(){this.composer.draft&&this.composer.draft.delete()}if(f().store.models.drafts=b,a().prototype.drafts=o().hasMany("drafts"),a().prototype.draftCount=o().attribute("draftCount"),f().routes.drafts={path:"/drafts",component:P},f().drafts=new ht(f()),st().prototype.changed=function(){var t=this;if(!this.body||!this.data)return!1;var e=this.data(),r=this.draft,n=Object.keys(e).filter((function(t){return"relationships"!==t}));if(!n)return!1;if(!this.fields.content())return!1;for(var a,s=function(r){return("content"===r?t.fields.content():e[r])||""},o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return gt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?gt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(n);!(a=o()).done;){var i=a.value,u=s(i),c=r&&r.data.attributes[i];if(!r&&u||r&&!mt(u,c))return!0}if(!e.relationships&&!r.relationships())return!1;for(var d=function(t,e,r){var n,a;if(!(t.relationships[r]&&t.relationships[r].length||r in e.relationships()&&null!=(n=e.relationships()[r].data)&&n.length))return!0;if(!(r in e.relationships())||t.relationships[r].length!==(null==(a=e.relationships()[r].data)?void 0:a.length))return!1;var s=function(t){return"function"==typeof t.id?t.id():t.id},o=y(t.relationships[r],s),i=y(e.relationships()[r].data,s);return!o.some((function(t,e){return t!==i[e]}))},l=0,f=Object.keys(e.relationships);l<f.length;l++){var h=f[l];if(r){if(!d(e,r,h))return!0}else if(e.relationships[h])return!0}return!1},st().prototype.saveDraft=function(){var t=this;this.saving=!0,m.redraw();var e=function(){t.saving=!1,t.justSaved=!0,setTimeout((function(){t.justSaved=!1,m.redraw()}),300),m.redraw()},r=this.draft;r&&r.id()&&!r.exists||(r?(delete r.data.attributes.relationships,r.save(Object.assign(r.data.attributes,this.data())).then((function(){return e()}))):f().store.createRecord("drafts").save(this.data()).then((function(r){r.loadRelationships(!0),t.draft=r,e()})))},(0,t.extend)(X().prototype,"controlItems",(function(t){if((this.state.bodyMatches(et())||this.state.bodyMatches(nt()))&&f().forum.attribute("canSaveDrafts")&&"minimized"!==this.state.position){var e=["Button","Button--icon","Button--link"];this.state.saving&&e.push("saving"),this.state.justSaved&&e.push("justSaved"),t.add("save-draft",A().component({icon:this.state.justSaved?"fas fa-check":this.state.saving?"fas fa-spinner fa-spin":"fas fa-save",className:e.join(" "),itemClassName:"App-backControl",title:f().translator.trans("fof-drafts.forum.composer.title"),disabled:this.state.saving||this.state.justSaved||this.loading,onclick:this.state.saveDraft.bind(this.state)}),20)}})),(0,t.extend)(st().prototype,"load",(function(){var t=this;f().forum.attribute("canSaveDrafts")&&f().session.user.preferences().draftAutosaveEnable&&(this.bodyMatches(et())||this.bodyMatches(nt()))&&(this.autosaveInterval=setInterval((function(){!t.changed()||t.saving||t.loading||t.saveDraft()}),1e3*f().session.user.preferences().draftAutosaveInterval))})),(0,t.extend)(st().prototype,"clear",(function(){this.draft=null,this.autosaveInterval&&clearInterval(this.autosaveInterval)})),(0,t.override)(st().prototype,"preventExit",(function(t){this.body&&this.body.componentClass&&this.draft&&(this.body.attrs.confirmExit=f().translator.trans("fof-drafts.forum.composer.exit_alert"));var e=!1;if(this.changed()&&(e=t()),e)return e;if(this.body&&this.body.componentClass){var r=this.draft;return r&&!r.title()&&!r.content()&&confirm(f().translator.trans("fof-drafts.forum.composer.discard_empty_draft_alert"))&&r.delete(),e}})),(0,t.extend)(et().prototype,"oninit",e),(0,t.extend)(nt().prototype,"oninit",e),(0,t.extend)(et().prototype,"onsubmit",r),(0,t.extend)(nt().prototype,"onsubmit",r),f().initializers.has("fof-byobu")){var n=flarum.extensions["fof-byobu"].discussions.PrivateDiscussionComposer;(0,t.extend)(n.prototype,"onsubmit",r)}(0,t.extend)(V().prototype,"items",(function(t){f().session.user&&f().forum.attribute("canSaveDrafts")&&t.add("Drafts",m(W,{state:f().drafts}),20)})),(0,t.extend)(Z().prototype,"oninit",(function(){this.draftAutosaveInterval=u()(this.user.preferences().draftAutosaveInterval)})),(0,t.extend)(Z().prototype,"settingsItems",(function(t){f().forum.data.attributes.canSaveDrafts&&t.add("drafts",G().component({label:f().translator.trans("fof-drafts.forum.user.settings.drafts_heading"),className:"Settings-drafts"},this.draftsItems().toArray()))})),Z().prototype.draftsItems=function(){var t=this,e=new(p());return e.add("draft-autosave-enable",Q().component({state:this.user.preferences().draftAutosaveEnable,onchange:function(e){t.draftAutosaveEnableLoading=!0,t.user.savePreferences({draftAutosaveEnable:e}).then((function(){t.draftAutosaveEnableLoading=!1,m.redraw()}))},loading:this.draftAutosaveEnableLoading},f().translator.trans("fof-drafts.forum.user.settings.draft_autosave_enable"))),e.add("draft-autosave-interval",this.user.preferences().draftAutosaveEnable?m("label",null,m("p",null,f().translator.trans("fof-drafts.forum.user.settings.draft_autosave_interval_label")),m("input",{className:"FormControl",type:"number",min:"0",bidi:this.draftAutosaveInterval}),A().component({className:"Button Button--primary",onclick:function(){var e;t.draftAutosaveInterval()<0||(e=t.draftAutosaveInterval())!=Math.round(e)?(t.draftAutosaveIntervalInvalid=!0,t.draftAutosaveInterval(t.user.preferences().draftAutosaveInterval),m.redraw()):(t.draftAutosaveIntervalInvalid=!1,t.user.savePreferences({draftAutosaveInterval:t.draftAutosaveInterval()}).then((function(){m.redraw()})))}},f().translator.trans("fof-drafts.forum.user.settings.draft_autosave_interval_button")),this.draftAutosaveIntervalInvalid?m("p",{class:"invalidInterval"},m("small",null,f().translator.trans("fof-drafts.forum.user.settings.draft_autosave_interval_invalid"))):""):m("p",null)),e}}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map